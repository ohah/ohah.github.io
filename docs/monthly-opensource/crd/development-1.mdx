---
title: 3-1. 배민 구현 따라하기
description: CRD에서 배민의 '따라하기' 기능을 어떤 식으로 구현했는지 설명
---

# 3-1. 배민 구현 따라하기

**배민 테크 블로그에서 따라 할 만한 부분**: "배민 구현 따라하기"는 웹 브라우저의 Console·DOM·DevTools를 자동으로 기록·재생하는 기능을, 개발자가 직접 흉내 내보는 시리즈로 보입니다. CRD에서도 유사한 목적의 기능을 하나 떼어내어, "배민 구현 따라하기"라는 제목으로 작성해 보기로 했습니다. 이번 파트에서는 **Bing Search** 패널을 자동으로 열고 검색어를 입력하는 기능을 예로 들어 설명합니다.

## 배민 기술 블로그의 '따라하기' 비전

배민은 CDP를 활용해 Console·Network·DOM을 기록한 뒤, 그걸 다시 재생하는 아주 강력한 데드리스트인데:

> **"기록방 URL로 당시 콘솔·네트워크·DOM 상태를 다시 볼 수 있습니다"**

하지만 개발자들은 여기서 끝나지 않고 더 멀리 갑니다.

배민 기술 블로그에서 소개하는 **"따라하기" 시리즈**는 기록한 상태를 그대로 재생하는 것, 아니라 **"나도 이걸 해봐야지"** 싶은 개발자들에게 레시피를 제시한다는 심리를 담고 있었습니다.

CRD 입장에서는:

> **"이걸 재현할 필요까지는 없고, 그 기능 자체는 흉내 내봐야지"**
> "이걸 왜 쓰려고 했지?"
> "그럼 기계가 뭘 하는 게 편할까?"

라는 생각에, 배민 기술 블로그 **Bing Search 패널 자동 열기** 기능을 흉내 내보기로 결정했습니다.

## CRD에서 따라 할 만한 기능: Bing Search 자동 열기

우선, CRD UI에서 검색 패널을 마우스로 열고 검색어를 입력하는 것은 **개발자가 직접 하는 일**입니다.

하지만 기록을 재생할 때는 **"사용자가 했던 것처럼 패널을 열고 입력까지"** 하는 게 자연스러운 흐름입니다.

그래서 CRD에서:

```
1. 사용자가 패널 ID를 입력으로 지정 (예: search-panel)
2. 기록 재생 시 해당 패널 자동 열림
3. 기록 안에 있는 검색어가 입력 트릭으로 자동 타이핑
```

이 기능을 구현하면, "기록 재생"이라는 단순 반복도 하나의 **자연스러운 사용자 동작**을 재현하는 과정으로 다가옵니다.

## 구현을 위해 알아야 할 것들

먼저 떠오르는 의문:

- **CDP 명령어**: "패널 열기"와 "타이핑"의 명령어는 무엇인가?
- **DevTools UI 구조**: 패널 ID는 어디서 나오는가? 어떤 식으로 구분하는가?
- **재생 루프**: 기록된 액션들을 순서대로 실행하는 것도 중요한데, UI 변화와 리액션 간의 순서를 어떻게 맞출 것인가?
- **오버라이딩**: 사용자가 직접 패널을 열어놓고 기록을 재생하면, 어떻게 충돌을 피하나?

이 모든 질문은 CRD 구현 도중에 하나씩 풀리게 되는 사이클입니다.

## CRD에 맞춘 기능 수정: UI, 명령어, 순서

배민의 "패널 열고 검색어 입력" 과정을 그대로 흉내 내려고 했지만, **CRD의 UI 구조와는 어긋나는 부분**이 너무나 많았습니다.

### 1. 패널 열기 명령어

우리가 CDP 명령어를 써보면:

```json
{"method": "Target.sendMessageToTarget", "params": {"targetId": "search-panel"}}
````

이건 명령어가 아니라 **"메시지 전송"**입니다. 실제로는:

```json
{"method": "Runtime.evaluate", "params": {"expression": "document.querySelector('#search-input').value = 'hello'" }}
````

이런 식의 스크립트가 필요합니다.

우리가 원하는 건 "검색 패널을 열고 입력창에 글씨를 쓰는 것"이지, DevTools Console에 자바스크립트를 실행하는 게 아닙니다. 그래서 **CDP의 `Runtime.evaluate` 아닌 `CDP 전용 액션`**으로 패널 자동 열기 기능을 직접 구현하기로 결정했습니다.

### 2. 검색어 입력과 리액션

"이 기능을 쓸 때 어떤 느낌일까?"를 위해, 기록 재생 중에:

```
1. 패널 열림 → UI 깜빡임
2. 입력창에 글씨가 써지는 애니메이션
3. 검색 패널 내부의 목록이 갱신되는 리액션
```

까지가 **자연스러운 사용자 경험(UX)**입니다.

하지만 기록을 단순히 "액션 순서대로 반복"으로만 구현하면:

```
1. 패널 열림
2. 입력창에 글씨가 써짐
3. 패널은 자동으로 열리고 아무 일도 안 일어남 (목록 갱신이 없음)
```

이건 너무 빠르고 어색합니다. 사용자는 "이게 다인가?"라고 생각할 겁니다.

그래서 CRD에서는 **"대기 시간(Delay)"**을 명시적으로 줘서, 사용자 동작 후 UI에 리액션이 생길 때까지 기다리는 시간을 확보하도록 구현했습니다.

### 3. DevTools UI의 패널 ID

원래 배민은 DevTools UI의 패널 ID를 콘솔 로그로 출력했다고 하는데, CRD에서는 **UI 구조를 분석해서 추출**하기로 했습니다.

우리가 사용하는 브라우저는 Tauri 기반이고 DevTools extension은 Chrome Extension으로 띄웁니다. 즉, 실제 DevTools UI 내부의 DOM은 **브라우저 내부의 페이지**이기 때문에, 패널 ID를 브라우저 내부의 쿼리로 추출할 수 있습니다.

```
#devtools-root #panel-search
````

이런 CSS 셀렉터로 패널을 찾으면 됩니다.

## 실제로 시도해 보기

먼저 **기록된 액션에서 패널 열기**를 떼어내더라도:

- 현재 열려 있는 패널 목록을 쿼리
- 원하는 패널이 열려 있는지 확인
- 열려 있지 않으면 패널 열기 액션을 추가

하는 로직은 필요합니다.

그리고 타이핑할 때는:

- 입력창이 있는 패널을 찾아서 포커스
- 문자열을 하나씩 입력
- 입력 후 리액션이 올 때까지 대기

이 순서대로 이터레이션을 진행하면, 배민의 "따라하기" 시리즈처럼 **사용자가 직접 하는 것처럼 흉내 낼 수 있습니다.**

## 끝까지 가기 위해 떠오르는 생각들

이 기능을 구현하다 보면:

- **CDP 명령어와 DevTools UI 사이의 괴리**: 어떤 명령어를 써야 할지 판단이 어려울 때가 있다.
- **UI 갱신 패턴 추출**: 특정 액션 후 리액션이 얼마나 걸리는지 구체적으로 알 수가 없다.
- **예외 처리**: 사용자가 직접 패널을 열어놨을 때, 자동 패널 열기가 겹치면 어떻게 할 것인가?

이런 고민이 언제나 시작 전에 떠오르지만, 다행히 실패할 구조가 없는 환경에서 도전해 볼 수 있다는 것 자체가 큰 장점입니다.

:::info 1줄 요약
배민의 '따라하기' 기능을 CRD에 맞춰 Bing Search 패널 자동 열기로 흉내 내면서, CDP 명령어와 UI 구조 사이의 차이, 타이핑과 리액션 간의 순서 문제를 제대로 겪어봄을 경험하며 "기록 재생"의 자연스러운 UX를 고민했다.
:::