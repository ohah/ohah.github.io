---
title: 3-7. 네이티브 걷어내기
description: 네이티브 의존성 제거
---

# 3-7. 네이티브 걷어내기

React Native에서 CRD를 쓰면서 뭔가 이상하다 싶은 게 있었다.

"나는 웹 환경에서 웹서핑해서 알게 된 걸 좋아한다"는 걸 명심하면서, 그것도 React Native로만 쓰는 디버깅 툴을 고집하고 있던 게 눈에 띄었다.

거울 보고 있었나? 라고 생각하면서, 일단은 네이티브 의존성을 하나씩 빼보기로 했다.

---

## 웹 플랫폼 완전히 따로 만들기

처음에는 React Native에서만 쓰는 부분을 주먹구구 식으로 만들어두다가, 나중에 웹에서도 동일한 기능을 써보고 싶더라.

그래서 "너무 네이티브 의존하고 있잖아? 일단 웹과 동일한 환경을 먼저 만들자"고 결심했다.

### 완전히 새로운 패키지

웹에서만 돌아가는 Inspector를 별도 패키지에서 만들기로 했다. 이 패키지는 다음과 같은 특징이 있었다:

- React Native와는 전혀 상관없는 순수 웹 코드
- 필요한 기능은 CDP 메시지나 Event Bus로만 통신
- 번들러는 Vite(이제 CRD는 Vite 기본)
- 최소한의 의존성만 가져간다

이걸 만들면서 처음으로 "웹 개발"이라는 걸 생각하게 됐다. 웹에서만 쓰는 건데도 이렇게 복잡한 설정과 의존성이 잔인한데, React Native로 갈아타면 그게 더 이중으로 느껴졌다.

### DevTools UI는 무조건 공통으로

웹과 React Native 모두에서 사용할 수 있는 UI는 따로 만들었다.

처음에는 각 플랫폼별로 UI를 각각 따로 만들려고 했는데, 이게 꼬이기 시작하니까 "이건 정신이 아파" 하는 감정이 들었다.

그래서 UI만 따로 만들고, 데이터 출처는 플랫폼별로 다르게 받도록 했다.

- 웹: 기존 CDP 클라이언트로부터 데이터 수신
- React Native: 네이티브 모듈을 통해 데이터 수신

UI 컴포넌트들은 완전히 공유하고, 내부 동작만 다르다.

### 어려웠던 점

- UI 컴포넌트를 웹에서만 쓰는 거였기 때문에 React Native에 그대로 붙이려니까 터치 이벤트가 꼬이는 문제가 있었다
- 처음엔 React Native용 포인터 이벤트를 별도로 만들어야 한다고 생각했는데, 마침 알게 된 건 리액트 네이티브 표준 컴포넌트가 터치 이벤트를 리다이렉트해서 웹 컴포넌트와 호환되도록 만들었다는 거였다
- 번들러 구성이 다르니까 UI 로딩 순서나 코드 스플릿 방식을 일일히 맞춰야 했다

---

## React Native용 Native 모듈은 최소화

웹 패키지 따로 만들었으니, 이제 React Native에서는 필요한 게 없을 줄 알았는데, 생각보다 있더라.

### 최소한의 네이티브 모듈만 남기기

이미 구현해둔 Native 모듈 몇 개만 남기고, 나머지는 다 걷어내기로 결정했다.

- WebSocket 관리는 플랫폼마다 다르지만, 얘네는 그냥 CDP 프로토콜 위에서 동작하면 되니까 브리지로 처리 가능
- 네트워크 요청도 CDP Network Domain으로 다시 관리 가능
- Hermes 실행 정보나 인라인 스캔은 React Native 전용이라 그냥 남겨둠

이렇게 하니 React Native 패키지가 훨씬 가벼워졌다. 번들링되는 코드의 크기가 웹과 비슷한 수준으로 줄었다.

### 네이티브 관련 리소스 최적화

React Native 앱에서 CRD를 로드할 때도 최적화를 시도했다.

- 처음에는 빈껍데기만 로드해서 "이건 없군요"라고 안내해줬는데, 나중에는 실제로 기능이 있는지에 따라 필요한 리소스만 로드하게 만들었다
- 네이티브 지원이 없으면 빈 패널을 띄워주고, 지원하면 실제 기능을 보여주는 꼼수를 썼다
- 배포 빌드에서는 CRD 관련 코드를 기본적으로 제외해서 앱의 용량을 줄였다

---

## 결과: 이제는 하나도 네이티브한 거 없다

결국 CRD는 웹과 React Native 모두서 사용하는 공통 툴이 되었다. 네이티브가 전혀 없다.

웹에서는 CDP 클라이언트만 있으면 끝이고, React Native에서는 필요한 네이티브 기능만 있다. 이제 나도 웹서핑해서 알게 된 걸 그대로 사용하고 있다는 느낌이 든다.

아니, 정확히 말하면 이제는 React Native에 의존해서 CRD를 쓰는 게 아니라, CRD를 만들어서 React Native를 쓴다는 느낌일 것이다.

:::info 1줄 요약
네이티브 의존성을 걷어내기 위해 웹 전용 Inspector를 새로 만들고, React Native용 Native 모듈을 최소화했다. 이제 CRD는 플랫폼에 상관없이 웹 기반이라, 웹서핑해도 알게 된 걸 그대로 쓰게 됐다.
:::