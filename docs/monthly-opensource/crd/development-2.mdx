---
title: 3-2. 배민 백로그까지 구현
date: 2026-02-15
description: 구현 완료라고 생각했지만, 실제 배포하려면 백로그 문제가 넘쳐났다.
---

# 3-2. 배민 백로그까지 구현

## 배민 백로그에 있던 "아직 지원 안 됨"을 구현했다

배민 기술 블로그나 레퍼런스 코드를 보면, 구현은 해 두었지만 "아직 지원 안 됨"으로 남겨 둔 항목이 꽤 있었다. 그중에서도 **로컬스토리지**, **세션 스토리지**, **쿠키** 같은 Storage 쪽은 "나중에 넣자" 수준으로 미뤄 둔 경우가 많았다. 웹뷰나 원격 디버깅에서 콘솔·네트워크가 먼저 필요하고, 스토리지는 부가 기능처럼 취급되기 때문인 것 같다.

난 그 백로그 항목들을 그대로 가져와서 CRD에서 구현해 뒀다. CDP의 **Storage 도메인**을 붙여서 Inspector 쪽 Application 패널에서 로컬스토리지·세션스토리지·쿠키를 조회하고, 필요하면 값 추가·수정·삭제까지 할 수 있게 했다. 타깃 페이지(웹이든 RN이든)에서 실제로 쓰는 스토리지 키·값이 그대로 보이니까, 디버깅할 때 상태를 바로 확인하거나 테스트용으로 값을 바꿔 보기 편해졌다.

## 문서 사이트에 데모 플레이 넣고 싶었다

[문서 사이트](https://ohah.github.io/chrome-remote-devtools/)에 올려 둔 CRD 소개에서, "기록 재생"이 어떻게 동작하는지 **데모로 한 번 돌려 보여 주고 싶었다**. 그냥 스크린샷이나 영상만 있으면 설명이 길어지고, 방문자가 직접 눌러 보는 게 훨씬 이해하기 쉽다고 생각했다.

문제는 구조였다. 기록 재생을 하려면 **타깃 페이지(클라이언트)**와 **Inspector**가 CDP 메시지를 실시간으로 주고받아야 한다. 지금 CRD 아키텍처는 그 중간에 **웹소켓 릴레이 서버**가 있어서, 클라이언트와 Inspector가 각각 서버에 붙고 서버가 메시지를 양쪽으로 넘겨 준다. 그런데 문서 사이트는 정적 호스팅이라 서버가 없다. 데모용으로 웹소켓 서버를 하나 파서 24시간 돌리자니 비용이 부담됐고, "문서만 보여 주는 사이트에 서버까지 둘까?" 하는 생각에 망설여졌다.

그래서 **웹소켓 대신 iframe + PostMessage**로 바꿨다. 문서 사이트 페이지 안에 **데모용 iframe**을 하나 띄우고, 그 iframe 안에는 CDP 클라이언트 스크립트가 붙은 미니 페이지가 로드되게 했다. Inspector UI는 문서 사이트(부모) 쪽에 두고, iframe(자식)과 부모 창이 **postMessage**로 CDP 메시지를 주고받게 했다. 같은 오리진이 아니어도 postMessage만 열어 두면 되니까, 별도 웹소켓 서버 없이도 "문서 사이트만 열면 데모 재생이 된다"는 걸 맞출 수 있었다. 방문자가 문서 읽다가 데모 버튼만 누르면 곧바로 재생이 돌아가는 식으로 만들어 뒀다.

## DevTools 키기 전 상황도 기록하고 싶었다

기록 재생을 쓰다 보니, "DevTools(Inspector)를 열기 **전**에 이미 일어난 동작"도 같이 남기고 나중에 그 시점부터 재생하고 싶다는 요구가 생겼다. 예를 들어 페이지 로드 직후의 콘솔 로그나 네트워크 요청은, Inspector를 나중에 열면 그때부터만 보이고 그전 것은 안 보인다. 그래서 **클라이언트가 연결되기 전부터** 이벤트를 버퍼에 쌓아 두고, 나중에 Inspector가 연결되면 그 버퍼를 CDP 형식으로 넘겨 주는 식이 필요했다.

그걸 위해 **IndexedDB**를 쓰기로 했다. 브라우저에 내장돼 있고 용량도 넉넉해서, 오래된 로그나 많은 이벤트를 쌓아 두기 좋았다. 다만 그대로 저장하면 금방 용량이 커지니까, 저장 전에 **압축**을 한 번 거치도록 했다. 재생할 때는 IndexedDB에서 해당 기록을 꺼내서 압축 해제한 뒤, CDP 메시지 순서에 맞게 다시 Inspector로 보내 주는 **재전송 파이프라인**을 만들었다. 이렇게 해 두니 "DevTools를 키기 전" 시점의 로그도 나중에 Inspector를 열고 불러와서 재생할 수 있게 됐고, 오프라인에서 쌓아 둔 로그를 나중에 온라인에서 Inspector로 불러와 보는 것도 가능해졌다.
